{"version":3,"file":"index.js","sources":["../../src/composables/useDragDrop.ts","../../src/composables/useEdgeScrollObserver.ts","../../src/composables/useWindowScrollLock.ts"],"sourcesContent":["// useDragDrop.ts\r\n\r\nimport { ref } from 'vue'\r\n\r\n/**\r\n * @fileoverview リスト要素の並べ替え（スワップ）と削除（リムーブ）を処理するためのドラッグ＆ドロップ用コンポーザブル関数。\r\n *\r\n * この関数は、Vue.jsのリアクティブな状態管理（ref）を用いて、\r\n * ドラッグ操作に必要なインデックスと、コンテナからの離脱/侵入を追跡します。\r\n *\r\n * 【使い方】\r\n * 1. コンポーネント内でインポートし、データとコールバックを渡します。\r\n *\r\n * const items = ref(['A', 'B', 'C'])\r\n * const { start, drop, end, dragEnterParent, dragLeaveParent, startIndex } = useDragDrop({\r\n * onSwap: (from, to) => {\r\n * // 配列の要素を入れ替えるロジックを実装\r\n * const item = items.value.splice(from, 1)[0]\r\n * items.value.splice(to, 0, item)\r\n * },\r\n * onRemove: (index) => {\r\n * // 配列から要素を削除するロジックを実装\r\n * items.value.splice(index, 1)\r\n * }\r\n * })\r\n *\r\n * 2. テンプレート内でHTMLイベントにバインドします。\r\n *\r\n * // --- 親要素（リスト全体）にバインド ---\r\n * <ul\r\n * @dragenter.prevent=\"dragEnterParent\"\r\n * @dragleave=\"dragLeaveParent\"\r\n * @dragover.prevent // dropを許可するために必要\r\n * >\r\n * // --- 子要素（各アイテム）にバインド ---\r\n * <li\r\n * v-for=\"(item, index) in items\"\r\n * :key=\"item\"\r\n * draggable=\"true\"\r\n * @dragstart=\"start(index)\"\r\n * @drop=\"drop(index)\"\r\n * @dragend=\"end\"\r\n * :class=\"{ 'is-dragging': startIndex === index }\"\r\n * >\r\n * {{ item }}\r\n * </li>\r\n * </ul>\r\n *\r\n * @param options - ドラッグ操作完了時の処理を定義するコールバック関数。\r\n * @param options.onSwap - 別の要素の上でドロップされたときに呼び出されます (from:元のindex, to:先のindex)。\r\n * @param options.onRemove - コンテナ外でドロップされたときに呼び出されます (index:元のindex)。\r\n * @returns ドラッグの状態と操作用のイベントハンドラ関数。\r\n */\r\nexport function useDragDrop(options?: {\r\n  onSwap?: (from: number, to: number) => void\r\n  onRemove?: (index: number) => void\r\n}) {\r\n  const startIndex = ref<number | null>(null)\r\n  const endIndex = ref<number | null>(null)\r\n  const dragLeaveEnterCounter = ref(0)\r\n  const dragLeaveCounter = ref(0)\r\n\r\n  const start = (index: number) => {\r\n    startIndex.value = index\r\n  }\r\n\r\n  const drop = (index: number) => {\r\n    if (startIndex.value === null) return\r\n    if (startIndex.value === index) return\r\n    endIndex.value = index\r\n  }\r\n\r\n  const end = () => {\r\n    if (startIndex.value === null) return\r\n    if (dragLeaveEnterCounter.value === 0 && dragLeaveCounter.value > 1) {\r\n      options?.onRemove?.(startIndex.value)\r\n    }\r\n    else {\r\n      if (endIndex.value !== null) {\r\n        options?.onSwap?.(startIndex.value, endIndex.value)\r\n      }\r\n    }\r\n    reset()\r\n  }\r\n\r\n  const dragLeaveParent = () => {\r\n    dragLeaveEnterCounter.value--\r\n    dragLeaveCounter.value++\r\n  }\r\n\r\n  const dragEnterParent = () => {\r\n    dragLeaveEnterCounter.value++\r\n  }\r\n\r\n  const reset = () => {\r\n    startIndex.value = null\r\n    endIndex.value = null\r\n    dragLeaveEnterCounter.value = 0\r\n    dragLeaveCounter.value = 0\r\n  }\r\n\r\n  return {\r\n    // 状態\r\n    startIndex,\r\n    endIndex,\r\n    dragLeaveEnterCounter,\r\n    dragLeaveCounter,\r\n    // イベントハンドラ\r\n    start,\r\n    drop,\r\n    end,\r\n    dragLeaveParent,\r\n    dragEnterParent,\r\n    reset,\r\n  }\r\n}\r\n","// useEdgeScrollObserver.ts\r\nimport { onUnmounted, ref } from 'vue'\r\nimport type { Ref } from 'vue'\r\n/**\r\n * スクロール要素の端到達を監視し、指定されたイベントを実行する汎用Composables\r\n *\r\n * @param elementRef 監視対象のHTMLElementのRef\r\n * @param scrollDirection スクロール方向 ('horizontal' | 'vertical')、デフォルトは 'vertical'\r\n * @param threshold 端到達と判定するしきい値 (px)、デフォルトは 500\r\n * @param onEdgeReached 端に到達したときに実行するコールバック関数\r\n */\r\nexport function useEdgeScrollObserver(\r\n  elementRef: Ref<HTMLElement | null>,\r\n  scrollDirection: 'horizontal' | 'vertical' = 'vertical',\r\n  threshold: number = 500,\r\n  onEdgeReached?: () => void\r\n) {\r\n  const isWaitingForNextPage = ref(false)\r\n\r\n  // 縦向き・横向きのスクロール情報取得ヘルパー\r\n  const getScrollMetrics = (el: HTMLElement) => {\r\n    if (scrollDirection === 'horizontal') {\r\n      const scrollAmount = Math.abs(el.scrollLeft)\r\n      const maxScroll = el.scrollWidth - el.clientWidth\r\n      const currentScrollPosition = scrollAmount\r\n      const distanceToContentEnd = maxScroll - currentScrollPosition\r\n\r\n      return {\r\n        isAtEnd: distanceToContentEnd < threshold,\r\n        distanceToContentEnd: distanceToContentEnd,\r\n        maxScroll: maxScroll,\r\n      }\r\n    }\r\n    else {\r\n      const scrollAmount = el.scrollTop\r\n      const maxScroll = el.scrollHeight - el.clientHeight\r\n      const currentScrollPosition = scrollAmount\r\n      const distanceToContentEnd = maxScroll - currentScrollPosition\r\n\r\n      return {\r\n        isAtEnd: distanceToContentEnd < threshold,\r\n        distanceToContentEnd: distanceToContentEnd,\r\n        maxScroll: maxScroll,\r\n      }\r\n    }\r\n  }\r\n\r\n  /** スクロールイベントハンドラ */\r\n  const onScroll = () => {\r\n    const el = elementRef.value\r\n\r\n    if (!el || isWaitingForNextPage.value) {\r\n      return\r\n    }\r\n\r\n    const { isAtEnd } = getScrollMetrics(el)\r\n\r\n    // 端に到達した判定\r\n    if (isAtEnd) {\r\n      // 監視を停止 利用側でresumeObserverで再開\r\n      isWaitingForNextPage.value = true\r\n\r\n      // 呼び出し側で指定されたイベントを実行\r\n      onEdgeReached?.()\r\n    }\r\n  }\r\n\r\n  /** 監視を再開 (onEdgeReached の処理完了後に呼び出す) */\r\n  const resumeObserver = () => {\r\n    isWaitingForNextPage.value = false\r\n  }\r\n\r\n  const setupObserver = () => {\r\n    const el = elementRef.value\r\n    if (!el) return\r\n    el.addEventListener('scroll', onScroll, { passive: true })\r\n  }\r\n\r\n  const cleanupObserver = () => {\r\n    const el = elementRef.value\r\n    if (el) {\r\n      el.removeEventListener('scroll', onScroll)\r\n    }\r\n  }\r\n\r\n  onUnmounted(cleanupObserver)\r\n\r\n  return {\r\n    setupObserver,\r\n    cleanupObserver,\r\n    resumeObserver,\r\n  }\r\n}","// useScrollLock.ts\r\nimport { ref, onUnmounted } from 'vue'\r\n\r\n/**\r\n * ウィンドウのスクロール操作をロック/解除する機能を提供するComposables。\r\n * すべての状態とロジックはこの関数内部で完結します。\r\n */\r\nexport function useWindowScrollLock() {\r\n  const isScrollLocked = ref(false)\r\n  let isListenerAttached = false\r\n  const preventWindowScroll = (e: Event) => {\r\n    if (isScrollLocked.value) {\r\n      e.preventDefault()\r\n      e.stopPropagation()\r\n      return false\r\n    }\r\n  }\r\n\r\n  const attachListeners = () => {\r\n    if (isListenerAttached) return\r\n    window.addEventListener('scroll', preventWindowScroll, { capture: true, passive: false })\r\n    window.addEventListener('wheel', preventWindowScroll, { capture: true, passive: false })\r\n    window.addEventListener('touchmove', preventWindowScroll, { capture: true, passive: false })\r\n\r\n    isListenerAttached = true\r\n  }\r\n\r\n  const detachListeners = () => {\r\n    if (!isListenerAttached) return\r\n\r\n    window.removeEventListener('scroll', preventWindowScroll, { capture: true })\r\n    window.removeEventListener('wheel', preventWindowScroll, { capture: true })\r\n    window.removeEventListener('touchmove', preventWindowScroll, { capture: true })\r\n\r\n    isListenerAttached = false\r\n  }\r\n\r\n  /** スクロール操作を一時的にロックする */\r\n  function lockScroll() {\r\n    if (isScrollLocked.value) return\r\n    isScrollLocked.value = true\r\n    attachListeners()\r\n  }\r\n\r\n  /** スクロールロックを解除する */\r\n  function unlockScroll() {\r\n    if (!isScrollLocked.value) return\r\n    isScrollLocked.value = false\r\n    detachListeners()\r\n  }\r\n\r\n  onUnmounted(detachListeners)\r\n\r\n  return {\r\n    isScrollLocked, // 現在のロック状態 (必要なら外部に公開)\r\n    lockScroll,     // ロック開始\r\n    unlockScroll,   // ロック解除\r\n  }\r\n}"],"names":[],"mappings":"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"}